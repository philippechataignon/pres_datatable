---
title: "Justice"
output:
  html_document: default
  html_notebook: default
---

On va lire le fichier csv qui contient les informations. 


```{r}
library(data.table)
jgt0 <- fread('~/data_jgt/dec_pev.csv')
setnames(jgt0, tolower(names(jgt0)))
```

On va garder uniquement les variables d'intérêt en filtrant sur les jugements au tribunal correctionnel.

```{r}
jgt0[etape=='JGT_TC',.(pev_id, date_evt, tgi, ms, tsursis, ssursis, date_infa, culp, qt)] -> jgt
jgt
```

On voit qu'il y a 3139602 jugements dans la table. On constate également que les colonnes
date_evt et date_infa ne sont pas au format "date" mais au format "character". On va règler
ce point en utilisant le package ``lubridate``.

```{r}
library(lubridate)
jgt <- jgt[, date_jgt:=ymd(date_evt)]
jgt <- jgt[, date_inf:=ymd(date_infa)]
jgt <- jgt[,date_evt:=NULL]
jgt <- jgt[,date_infa:=NULL]
jgt
```

Combien de jugements en 2015 ?

```{r}
jgt[year(date_jgt)==2015, .N]
```

Quelles peines principales pour ces jugements ?

```{r}
jgt[year(date_jgt)==2015, .N, by=ms]
```

Et si on triait par effectif décroissant ?

```{r}
jgt[year(date_jgt)==2015, .N, by=ms][order(-N)]
```

C'est quoi cette valeur manquante en troisième ligne ? 
Toutes les personnes jugées ne sont pas reconnues coupables. En cas de
relaxe (et les cas d'irresponsabilité pénale), il n'y a pas de peine.

```{r}
jgt[year(date_jgt)==2015, .N, by=culp][order(-N)]
```

Pour un tableau concernant les peines prononcées, il faut 
ajouter un filtre en ne gardant que les coupables.

```{r}
jgt[year(date_jgt)==2015 & culp=='CLP', .N, by=ms][order(-N)]
```

Evolution annuelle des peines d'emprisonnement

```{r}
jgt[culp=='CLP' & ms=='EPR', .N, by=year(date_jgt)][order(year)]
```

Quantum moyen annuel des peines d'emprisonnement


```{r}
jgt[culp=='CLP' & ms=='EPR' & date_jgt>='2012-01-01', mean(qt), by=year(date_jgt)][order(year)]
```


Lecture du fichier des infractions

```{r}
inf <- fread('~/data_jgt/jgt_inf.csv')
setnames(inf, tolower(names(inf)))
inf <- inf[,.(pev_id, natinf, inf_synth)]
```

On va créer une clé (= un index) pour les tables jgt et inf
sur la variable pev_id

```{r}
setkey(jgt, pev_id)
setkey(inf, pev_id)
print(jgt)
print(inf)
```

On peut maintenant accéder beaucoup plus rapidement aux
lignes correspondant à un pev_id donné.

```{r}
print(jgt[.(192376621)])
print(inf[.(192376621)])
```

Autre intérêt : on peut rapidement rapprocher les tables.
Par exemple on va compter les jugements qui ont jugé
l'infraction 7325 "Apologie d'un acte de terrorisme"

```{r}
inf[natinf==7325]
```

Pour obtenir les jugements correspondants aux infractions, la syntaxe est assez originale.
Il faut imaginer qu'on passe les clés issues de la table dans le crochet, inf dans notre cas,
à la table jgt. On obtient ainsi les jugements dont l'une des infractions a le code 7325.

```{r}
jgt[inf[natinf==7325]]
```

On peut ensuite faire le tableau des effectifs annuels :

```{r}
jgt[inf[natinf==7325], nomatch=0][,.N,by=.(year(date_jgt))]
```
